{
  "swagger": "2.0",
  "info": {
    "version": "1.0.0",
    "title": "Retail Tractors users-service API",
    "description": "API documentation for the Retail Tractors users-service."
  },
  "host": "localhost:3003",
  "basePath": "/users",
  "tags": [
    {
      "name": "Users",
      "description": "Operations related to user management"
    },
    {
      "name": "Auth",
      "description": "Authentication & password recovery endpoints"
    }
  ],
  "schemes": [
    "http"
  ],
  "securityDefinitions": {
    "BearerAuth": {
      "type": "apiKey",
      "name": "Authorization",
      "in": "header",
      "description": "Insert token as: Bearer <token>"
    }
  },
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/": {
      "get": {
        "tags": [
          "Users"
        ],
        "description": "List all users (admin only).",
        "parameters": [
          {
            "name": "authorization",
            "in": "header",
            "type": "string"
          }
        ],
        "responses": {
          "200": {
            "description": "List of users returned successfully.",
            "schema": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "id": {
                    "type": "number",
                    "example": 1
                  },
                  "name": {
                    "type": "string",
                    "example": "John Doe"
                  },
                  "email": {
                    "type": "string",
                    "example": "john@example.com"
                  },
                  "role": {
                    "type": "string",
                    "example": "USER"
                  }
                }
              },
              "xml": {
                "name": "main"
              }
            }
          },
          "401": {
            "description": "Missing or invalid token."
          },
          "403": {
            "description": "User does not have ADMIN role."
          }
        },
        "security": [
          {
            "BearerAuth": []
          }
        ]
      }
    },
    "/register": {
      "post": {
        "tags": [
          "Auth"
        ],
        "description": "Register a new user.",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "example": "John Doe"
                },
                "email": {
                  "type": "string",
                  "example": "john@example.com"
                },
                "password": {
                  "type": "string",
                  "example": "1234"
                }
              }
            }
          }
        ],
        "responses": {
          "201": {
            "description": "User created successfully.",
            "schema": {
              "type": "object",
              "properties": {
                "data": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "number",
                      "example": 1
                    },
                    "name": {
                      "type": "string",
                      "example": "John"
                    },
                    "email": {
                      "type": "string",
                      "example": "john@example.com"
                    },
                    "role": {
                      "type": "string",
                      "example": "USER"
                    }
                  }
                }
              },
              "xml": {
                "name": "main"
              }
            }
          },
          "400": {
            "description": "Missing fields, weak password, or invalid email."
          },
          "409": {
            "description": "Email already exists."
          }
        }
      }
    },
    "/login": {
      "post": {
        "tags": [
          "Auth"
        ],
        "description": "Login a user and retrieve JWT token.",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "email": {
                  "type": "string",
                  "example": "john@example.com"
                },
                "password": {
                  "type": "string",
                  "example": "1234"
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "JWT token returned.",
            "schema": {
              "type": "object",
              "properties": {
                "token": {
                  "type": "string",
                  "example": "jwt.token.here"
                }
              },
              "xml": {
                "name": "main"
              }
            }
          },
          "400": {
            "description": "Missing email or password."
          },
          "401": {
            "description": "Invalid credentials."
          }
        }
      }
    },
    "/forgot-password": {
      "post": {
        "tags": [
          "Auth"
        ],
        "description": "Request a password reset token via email.",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "schema": {
              "type": "object",
              "properties": {
                "email": {
                  "type": "string",
                  "example": "john@example.com"
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Password reset email sent."
          },
          "400": {
            "description": "Invalid or missing email."
          },
          "404": {
            "description": "User not found."
          }
        }
      }
    },
    "/reset-password": {
      "post": {
        "tags": [
          "Auth"
        ],
        "description": "Reset a user password with the provided reset token.",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "schema": {
              "type": "object",
              "properties": {
                "email": {
                  "type": "string",
                  "example": "john@example.com"
                },
                "token": {
                  "type": "string",
                  "example": "resetTokenHere"
                },
                "newPassword": {
                  "type": "string",
                  "example": "newPass123"
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Password reset successfully."
          },
          "400": {
            "description": "Invalid token, expired token, or weak password."
          },
          "404": {
            "description": "User not found."
          }
        }
      }
    },
    "/{id}": {
      "get": {
        "tags": [
          "Users"
        ],
        "description": "Retrieve a single user by ID (user can only access their own profile).",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "integer"
          },
          {
            "name": "authorization",
            "in": "header",
            "type": "string"
          }
        ],
        "responses": {
          "200": {
            "description": "User retrieved.",
            "schema": {
              "type": "object",
              "properties": {
                "data": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "number",
                      "example": 1
                    },
                    "name": {
                      "type": "string",
                      "example": "John"
                    },
                    "email": {
                      "type": "string",
                      "example": "john@example.com"
                    }
                  }
                }
              },
              "xml": {
                "name": "main"
              }
            }
          },
          "401": {
            "description": "Missing or invalid token."
          },
          "403": {
            "description": "User trying to access another user's account."
          },
          "404": {
            "description": "User not found."
          }
        },
        "security": [
          {
            "BearerAuth": []
          }
        ]
      },
      "put": {
        "tags": [
          "Users"
        ],
        "description": "Edit user profile (name/email only).",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "authorization",
            "in": "header",
            "type": "string"
          },
          {
            "name": "body",
            "in": "body",
            "schema": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "example": "New name"
                },
                "email": {
                  "type": "string",
                  "example": "newemail@example.com"
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User updated.",
            "schema": {
              "type": "object",
              "properties": {
                "data": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "number",
                      "example": 1
                    },
                    "name": {
                      "type": "string",
                      "example": "New name"
                    },
                    "email": {
                      "type": "string",
                      "example": "newemail@example.com"
                    }
                  }
                }
              },
              "xml": {
                "name": "main"
              }
            }
          },
          "400": {
            "description": "Invalid email or missing fields."
          },
          "401": {
            "description": "Missing token."
          },
          "403": {
            "description": "Not authorized to edit this user."
          },
          "404": {
            "description": "User not found."
          },
          "409": {
            "description": "Email already exists."
          }
        },
        "security": [
          {
            "BearerAuth": []
          }
        ]
      },
      "delete": {
        "tags": [
          "Users"
        ],
        "description": "Delete a user (admin only).",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "authorization",
            "in": "header",
            "type": "string"
          }
        ],
        "responses": {
          "204": {
            "description": "User deleted successfully."
          },
          "401": {
            "description": "Invalid or missing token."
          },
          "403": {
            "description": "User must be ADMIN."
          },
          "404": {
            "description": "User not found."
          }
        },
        "security": [
          {
            "BearerAuth": []
          }
        ]
      }
    },
    "/{id}/role": {
      "patch": {
        "tags": [
          "Users"
        ],
        "description": "Update a user role (admin only).",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "authorization",
            "in": "header",
            "type": "string"
          },
          {
            "name": "body",
            "in": "body",
            "schema": {
              "type": "object",
              "properties": {
                "role": {
                  "type": "string",
                  "example": "ADMIN"
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Role updated successfully."
          },
          "400": {
            "description": "Invalid or missing role."
          },
          "401": {
            "description": "Missing/invalid token."
          },
          "403": {
            "description": "User does not have ADMIN role."
          },
          "404": {
            "description": "User not found."
          }
        },
        "security": [
          {
            "BearerAuth": []
          }
        ]
      }
    }
  },
  "definitions": {
    "User": {
      "type": "object",
      "properties": {
        "id": {
          "type": "number",
          "example": 1
        },
        "name": {
          "type": "string",
          "example": "John Doe"
        },
        "email": {
          "type": "string",
          "example": "john@example.com"
        },
        "role": {
          "type": "string",
          "example": "USER"
        }
      }
    },
    "CreateUserRequest": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "example": "John Doe"
        },
        "email": {
          "type": "string",
          "example": "john@example.com"
        },
        "password": {
          "type": "string",
          "example": "1234"
        }
      }
    },
    "LoginRequest": {
      "type": "object",
      "properties": {
        "email": {
          "type": "string",
          "example": "john@example.com"
        },
        "password": {
          "type": "string",
          "example": "1234"
        }
      }
    },
    "LoginResponse": {
      "type": "object",
      "properties": {
        "token": {
          "type": "string",
          "example": "jwt.token.here"
        }
      }
    },
    "ForgotPasswordRequest": {
      "type": "object",
      "properties": {
        "email": {
          "type": "string",
          "example": "john@example.com"
        }
      }
    },
    "ResetPasswordRequest": {
      "type": "object",
      "properties": {
        "email": {
          "type": "string",
          "example": "john@example.com"
        },
        "token": {
          "type": "string",
          "example": "reset-token-here"
        },
        "newPassword": {
          "type": "string",
          "example": "1234"
        }
      }
    },
    "UpdateUserRequest": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "example": "Updated Name"
        },
        "email": {
          "type": "string",
          "example": "updated@example.com"
        }
      }
    },
    "ChangeRoleRequest": {
      "type": "object",
      "properties": {
        "role": {
          "type": "string",
          "example": "ADMIN"
        }
      }
    },
    "ErrorResponse": {
      "type": "object",
      "properties": {
        "error": {
          "type": "string",
          "example": "Something went wrong"
        }
      }
    }
  }
}